# Copyright 2001-2015 Sourcefire, Inc. All Rights Reserved.
#
# This file contains (i) proprietary rules that were created, tested and certified by
# Sourcefire, Inc. (the "VRT Certified Rules") that are distributed under the VRT
# Certified Rules License Agreement (v 2.0), and (ii) rules that were created by
# Sourcefire and other third parties (the "GPL Rules") that are distributed under the
# GNU General Public License (GPL), v2.
# 
# The VRT Certified Rules are owned by Sourcefire, Inc. The GPL Rules were created
# by Sourcefire and other third parties. The GPL Rules created by Sourcefire are
# owned by Sourcefire, Inc., and the GPL Rules not created by Sourcefire are owned by
# their respective creators. Please see http://www.snort.org/snort/snort-team/ for a
# list of third party owners and their respective copyrights.
# 
# In order to determine what rules are VRT Certified Rules or GPL Rules, please refer
# to the VRT Certified Rules License Agreement (v2.0).
#
#-----------------------
# FILE-EXECUTABLE RULES
#-----------------------

# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Microsoft Windows Authenticode signature verification bypass attempt"; flow:to_server,established; flowbits:isset,file.exe; content:"|E0 00 22 01 0B 01 0A 00 00 64 00 00 00 2E 00 00|"; fast_pattern; content:"|00 B0 00 00 50 0E 00 00 30 15 00 00 1C 00 00 00|"; within:16; distance:112; metadata:service smtp; reference:cve,2010-0151; reference:url,technet.microsoft.com/en-us/security/bulletin/ms12-024; classtype:attempted-user; sid:26601; rev:3;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows Authenticode signature verification bypass attempt"; flow:to_client,established; flowbits:isset,file.exe; content:"|E0 00 22 01 0B 01 0A 00 00 64 00 00 00 2E 00 00|"; fast_pattern; content:"|00 B0 00 00 50 0E 00 00 30 15 00 00 1C 00 00 00|"; within:16; distance:112; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2010-0151; reference:url,technet.microsoft.com/en-us/security/bulletin/ms12-024; classtype:attempted-user; sid:26590; rev:4;)
# alert tcp $HOME_NET any -> $HOME_NET [139,445] (msg:"FILE-EXECUTABLE Microsoft Windows executable file save onto SMB share attempt"; flow:to_server,established; content:"SMB"; depth:3; offset:5; content:"MZ"; within:150; byte_jump:4,58,relative,little; content:"PE|00 00|"; within:4; distance:-64; fast_pattern; metadata:service netbios-ssn; classtype:policy-violation; sid:26385; rev:2;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Ichitaro JSMISC32.dll dll-load exploit attempt"; flow:to_server,established; flowbits:isset,file.exe; file_data; content:"|83 EC 40 C7 04 24 54 4D 45 4D C7 44 24 04 4F 2E 4A 54 C7 44 24 08 44 00 00 00 8B C4 50 BB E8 C5 3F 21 FF 13 83 C4 40 E9 B2 BF FF FF|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service smtp; reference:cve,2013-0707; classtype:attempted-user; sid:26071; rev:2;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Ichitaro JSMISC32.dll dll-load exploit attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|83 EC 40 C7 04 24 54 4D 45 4D C7 44 24 04 4F 2E 4A 54 C7 44 24 08 44 00 00 00 8B C4 50 BB E8 C5 3F 21 FF 13 83 C4 40 E9 B2 BF FF FF|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2013-0707; classtype:attempted-user; sid:26070; rev:3;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Microsoft Windows Authenticode signature verification bypass attempt"; flow:to_server,established; flowbits:isset,file.exe; file_data; content:"|D8 7B 7B 6F 6E B9 9B 95 BB 99 81 A8 E0 AF 32 23 75 57 DB AC 5C BD 34 A4 94 A6 E3 4A DC EF EB F5|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service smtp; reference:cve,2012-0151; classtype:attempted-user; sid:25779; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows Authenticode signature verification bypass attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|D8 7B 7B 6F 6E B9 9B 95 BB 99 81 A8 E0 AF 32 23 75 57 DB AC 5C BD 34 A4 94 A6 E3 4A DC EF EB F5|"; fast_pattern:only; metadata:policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-0151; classtype:attempted-user; sid:25357; rev:7;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Microsoft Windows .NET Framework System.Uri.ReCreateParts System.Uri.PathAndQuery overflow attempt"; flow:to_server,established; file_data; flowbits:isset,file.exe; content:"|12 00 32 06 7B 00 12 00 38 06 7B 00 12 00 67 06 5B 06 06 00 83 06 7B 00 06 00 91 06 7B 00 06 00|"; fast_pattern:only; metadata:policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop, service smtp; reference:cve,2012-0015; reference:url,technet.microsoft.com/en-us/security/bulletin/MS12-016; classtype:attempted-user; sid:25253; rev:7;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows .NET Framework System.Uri.ReCreateParts System.Uri.PathAndQuery overflow attempt"; flow:to_client,established; file_data; flowbits:isset,file.exe; content:"|12 00 32 06 7B 00 12 00 38 06 7B 00 12 00 67 06 5B 06 06 00 83 06 7B 00 06 00 91 06 7B 00 06 00|"; fast_pattern:only; metadata:policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-0015; reference:url,technet.microsoft.com/en-us/security/bulletin/MS12-016; classtype:attempted-user; sid:25252; rev:7;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Software Installer MSI binary file magic detected"; flow:to_client,established; flowbits:isnotset,file.msi; flowbits:isset,file.ole|file.oless.v3; flowbits:isset,file.exe; file_data; content:"This program cannot be run in DOS"; fast_pattern:only; metadata:policy max-detect-ips drop, service ftp-data, service http, service imap, service pop3; classtype:policy-violation; sid:25061; rev:7;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft .NET blacklisted method reflection sandbox bypass attempt"; flow:to_client,established; file_data; content:"_FieldInfo"; fast_pattern:only; content:"Main|00|mscoree.dll"; content:"EndInvoke"; content:"BeginInvoke"; metadata:policy balanced-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-1895; reference:url,technet.microsoft.com/en-us/security/bulletin/MS12-074; classtype:misc-activity; sid:24665; rev:4;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Microsoft .NET blacklisted method reflection sandbox bypass attempt"; flow:to_server,established; file_data; content:"_FieldInfo"; fast_pattern:only; content:"Main|00|mscoree.dll"; content:"EndInvoke"; content:"BeginInvoke"; metadata:policy balanced-ips drop, policy security-ips drop, service smtp; reference:cve,2012-1895; reference:url,technet.microsoft.com/en-us/security/bulletin/MS12-074; classtype:misc-activity; sid:24664; rev:3;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE ClamAV UPX File Handling Heap overflow attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|33 32 B2 FD FF 25 1C C1 40 00 05 18 14 10 7F FB|"; fast_pattern:only; metadata:service ftp-data, service http, service imap, service pop3; reference:bugtraq,19381; reference:cve,2006-4018; classtype:attempted-user; sid:24238; rev:4;)
# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE ClamAV UPX File Handling Heap overflow attempt"; flow:to_server,established; flowbits:isset,file.exe; file_data; content:"|33 32 B2 FD FF 25 1C C1 40 00 05 18 14 10 7F FB|"; fast_pattern:only; metadata:service smtp; reference:bugtraq,19381; reference:cve,2006-4018; classtype:attempted-user; sid:24237; rev:4;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Portable Executable multiple antivirus evasion attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|57 69 6E 5A 69 70|"; depth:6; offset:29; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2012-1432; classtype:attempted-user; sid:23313; rev:5;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Portable Executable multiple antivirus evasion attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"MZ"; depth:2; content:"JFIF"; depth:4; offset:6; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2012-1433; classtype:attempted-user; sid:23312; rev:5;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Portable Executable multiple antivirus evasion attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|19 04 00 10|"; depth:4; offset:8; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2012-1434; classtype:attempted-user; sid:23311; rev:5;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Portable Executable multiple antivirus evasion attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"PKLITE"; depth:6; offset:30; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2012-1435; classtype:attempted-user; sid:23310; rev:5;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Portable Executable multiple antivirus evasion attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"MZ|2D 6C 68|"; depth:5; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2012-1436; classtype:attempted-user; sid:23309; rev:5;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Armadillo v1.71 packer file magic detected"; flow:to_client,established; flowbits:isnotset,file.msi; flowbits:isnotset,file.packed; flowbits:isset,file.exe; file_data; isdataat:17; content:"|55 8B EC 6A FF 68|"; content:"|68|"; within:1; distance:4; content:"|64 A1|"; within:2; distance:4; metadata:policy max-detect-ips drop, service ftp-data, service http, service imap, service pop3; classtype:policy-violation; sid:23256; rev:9;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows .NET Framework xbap DataObject object pointer attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"GetFormats"; content:"System.Runtime.InteropServices.ComTypes.IDataObject.GetDataHere.GetDataHere.sender.e.connectionId"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-1855; reference:url,technet.microsoft.com/en-us/security/bulletin/MS12-038; classtype:attempted-user; sid:23181; rev:6;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows .NET xbap STGMEDIUM.unionmember arbitrary number overwrite attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|0E 43 6C 69 63 6B 20 74 6F 20 72 65 70 72 6F 99 FD 24 0A D0 FF 04 4C 65 66 74 3D FF 24 09 C8 FF|"; fast_pattern:only; content:"System.Runtime.InteropServices.ComTypes.IDataObject.GetDataHere"; metadata:policy balanced-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-1855; reference:url,technet.microsoft.com/en-us/security/bulletin/MS12-038; classtype:attempted-user; sid:23127; rev:5;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows Authenticode signature verification bypass attempt"; flow:to_client,established; file_data; flowbits:isset,file.exe; content:"MZ"; depth:2; nocase; byte_jump:4,60,little,from_beginning; content:"PE|00 00|"; within:4; nocase; content:"|0B 02|"; within:2; distance:20; byte_test:4,<,0x3d,142,relative,little; byte_test:4,>,0x0,142,relative,little; metadata:policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-0151; classtype:attempted-user; sid:22942; rev:8;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows .NET invalid parsing of graphics data attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"System|2E|Drawing|2E|Drawing2D|00|GraphicsPath"; fast_pattern:only; content:"W|00|p|00|f|00|B|00|r|00|o|00|w|00|s|00|e|00|r|00|A|00|p|00|p|00|l|00|i|00|c|00|a|00|t|00|i|00|o|00|n|00 2E 00|P|00|r|00|o|00|p|00|e|00|r|00|t|00|i|00|e|00|s|00 2E 00|R|00|e|00|s|00|o|00|u|00|r|00|c|00|e|00|s"; nocase; metadata:policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-0163; reference:url,technet.microsoft.com/en-us/security/bulletin/ms12-025; classtype:attempted-user; sid:22042; rev:9;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows Authenticode signature verification bypass attempt"; flow:to_client,established; file_data; flowbits:isset,file.exe; content:"MZ"; depth:2; nocase; byte_jump:4,60,little,from_beginning; content:"PE|00 00|"; within:4; nocase; content:"|0B 01|"; within:2; distance:20; byte_test:4,<,0x3d,126,relative,little; byte_test:4,>,0x0,126,relative,little; metadata:policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-0151; classtype:attempted-user; sid:21795; rev:9;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows .NET invalid parsing of graphics data attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"System|2E|Drawing|00|Bitmap|00|Graphics"; fast_pattern:only; content:"A|00|t|00|t|00|e|00|m|00|p|00|t|00|i|00|n|00|g|00 20 00|t|00|o|00 20 00|w|00|r|00|i|00|t|00|e|00 20 00|8|00 20 00|P|00|o|00|i|00|n|00|t|00|s|00 20 00|i|00|n|00|t|00|o"; nocase; metadata:policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-0163; reference:url,technet.microsoft.com/en-us/security/bulletin/ms12-025; classtype:attempted-user; sid:21792; rev:10;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft .NET Framework System.Uri.ReCreateParts System.Uri.PathAndQuery overflow attempt"; flow:to_client,established; file_data; flowbits:isset,file.exe; content:"|59 A3 0F 90 16 C4 78 40 A0 36 F0 3A 84 0E 02 97 00 08 B7 7A 5C 56 19 34 E0 89 05 00 01 01 1D 0E|"; fast_pattern:only; content:"get_PathAndQuery"; nocase; metadata:policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2012-0015; reference:url,technet.microsoft.com/en-us/security/bulletin/MS12-016; classtype:attempted-user; sid:21305; rev:9;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE APP-CONTROL Thunder p2p application download detection"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"C|00|o|00|m|00|p|00|a|00|n|00|y|00|N|00|a|00|m|00|e"; nocase; content:"|F1 6D 33 57 02 5E C5 8F F7 96 51 7F DC 7E 80 62 2F 67 09 67 50 96 6C 51 F8 53|"; distance:0; content:"P|00|r|00|o|00|d|00|u|00|c|00|t|00|N|00|a|00|m|00|e"; distance:0; content:"|C5 8F F7 96|"; distance:0; metadata:service ftp-data, service http, service imap, service pop3; reference:url,en.wikipedia.org/wiki/Xunlei; classtype:policy-violation; sid:21173; rev:4;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows afd.sys kernel-mode memory corruption attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|8B 45 FC 50 6A|"; byte_test:1,>,24,0,relative; content:"|8D 8D A0 FD FF FF 51 68 BB 20 01 00 8B 55 F8 52 FF 15 18|"; content:"|40 00|"; within:2; distance:1; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2011-2005; reference:url,technet.microsoft.com/en-us/security/bulletin/MS11-080; classtype:attempted-admin; sid:20270; rev:9;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows win32k.sys kernel mode null pointer dereference attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|68 A2 01 00 00 68 FF FF 00 00 FF 15 30|"; fast_pattern; content:"|41 00|"; within:2; distance:1; metadata:policy max-detect-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2011-1985; reference:url,technet.microsoft.com/en-us/security/bulletin/MS11-077; classtype:attempted-admin; sid:20261; rev:12;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows CSRSS SrvDeviceEvent exploit attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|06 7C BD EB 05 BA CC CC CC CC 8B 75 08 33 FF 8B C6 85 F6 74 56 8B 40 04 47 85 C0 75 F8 85 F6 74 4A 39 16 75 0F 39 56 14 75 0A 39 56 18 75 05 39|"; fast_pattern:only; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2011-1967; reference:url,technet.microsoft.com/en-us/security/bulletin/MS11-063; classtype:attempted-user; sid:19680; rev:9;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows NDISTAPI Driver code execution attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|FF 25 A8 81 41 00 FF 25 C4 82 41 00 CC CC CC CC 75 01 C3 55 8B EC 83 EC 00 50 52 53 56 57 8B 45 04 6A 00 50 E8 D0 FC FF FF 83 C4 08 5F 5E 5B 5A|"; fast_pattern:only; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2011-1974; reference:url,technet.microsoft.com/en-us/security/bulletin/MS11-062; classtype:attempted-admin; sid:19679; rev:9;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE ClamAV UPX File Handling Buffer Overflow attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|55 50 58 31 00 00 00 00 00 50 00 00 00 10 10 00 00 48 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 40 00 00 E0|"; content:"|D7 FE EF 14 02 2D 8B F8 8D 44 24 18 50 FF 74 04 10 03 7F 1D 2F FF 6F DF 8B D8 19 B5 2E 18 5F 5E 8B C3 5B C3 83 3D E8 A6 02 74 05 BE BD EB 76 16|"; distance:0; metadata:policy max-detect-ips drop, service ftp-data, service http, service imap, service pop3; reference:bugtraq,14866; reference:cve,2005-2920; classtype:attempted-user; sid:17358; rev:11;)
# alert tcp $HOME_NET [139,445] -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows executable file load from SMB share attempt"; flow:to_client,established; content:"SMB"; depth:3; offset:5; content:"MZ"; within:150; byte_jump:4,58,relative,little; content:"PE|00 00|"; within:4; distance:-64; fast_pattern; metadata:policy max-detect-ips drop, service netbios-ssn; classtype:policy-violation; sid:17210; rev:8;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"FILE-EXECUTABLE potentially executable file upload via FTP"; flow:established,to_server; content:"STOR"; depth:4; nocase; pcre:"/^STOR[^\r\n]+?\.(com|dll|exe|js|vbs)\s+/smi"; metadata:service ftp; reference:url,tools.ietf.org/html/rfc959; classtype:policy-violation; sid:16363; rev:6;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE download of executable content"; flow:to_client,established; content:"application/x-msdos-program"; fast_pattern; nocase; http_header; pcre:"/^Content-Type\x3a[\x20\x09]+application\/x-msdos-program/smiH"; file_data; content:"MZ"; within:2; metadata:service ftp-data, service http, service imap, service pop3; reference:url,www.microsoft.com/smallbusiness/resources/technology/security/practice_safe_computing_and_thwart_online_thugs.mspx; classtype:policy-violation; sid:16313; rev:12;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows .NET MSIL CombineImpl suspicious usage attempt"; flow:to_client,established; flowbits:isset,file.exe; file_data; content:"|00|CombineImpl|00|"; fast_pattern:only; metadata:service ftp-data, service http, service imap, service pop3; reference:cve,2009-0091; reference:url,technet.microsoft.com/en-us/security/bulletin/MS09-061; classtype:attempted-user; sid:16183; rev:14;)
# alert tcp $EXTERNAL_NET [110,143] -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows Vista Windows mail file execution attempt"; flow:to_client,established; content:"href|3D|"; nocase; pcre:"/^[^\x22]*?\x22([a-z]\x3A[\x2F\x5C]|[\x2F\x5C]{2,4})/iR"; reference:cve,2007-1658; reference:url,technet.microsoft.com/en-us/security/bulletin/ms07-034; classtype:attempted-user; sid:16023; rev:5;)
# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Microsoft Windows Vista Windows mail file execution attempt"; flow:to_server,established; content:"href|3D|"; nocase; pcre:"/<a[^>]+href\s*=\s*(3D)?(\x22|\x27|)([a-z]\x3A[\x2F\x5C]|[\x2F\x5C]{2,4})/i"; metadata:policy max-detect-ips drop, service smtp; reference:cve,2007-1658; reference:url,technet.microsoft.com/en-us/security/bulletin/ms07-034; classtype:attempted-user; sid:16022; rev:14;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Portable Executable binary file magic detected"; flow:to_client,established; file_data; content:"MZ"; byte_jump:4,58,relative,little; content:"PE|00 00|"; within:4; distance:-64; metadata:policy max-detect-ips drop, service ftp-data, service http, service imap, service pop3; classtype:policy-violation; sid:15306; rev:22;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE download of executable content"; flow:to_client,established; content:"application/octet-stream"; fast_pattern; nocase; http_header; pcre:"/^Content-Type\x3a[\x20\x09]+application\/octet-stream/smiH"; file_data; content:"MZ"; within:2; metadata:policy max-detect-ips drop, service http; reference:url,www.microsoft.com/smallbusiness/resources/technology/security/practice_safe_computing_and_thwart_online_thugs.mspx; classtype:policy-violation; sid:11192; rev:20;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Microsoft Windows NtUserMessageCall implementation exploitation attempt"; flow:to_server,established; file_data; flowbits:isset,file.exe; file_data; content:"schlamperei.x86.dll|00|_ReflectiveLoader"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service smtp; reference:cve,2013-1300; reference:url,technet.microsoft.com/en-us/security/bulletin/MS11-053; classtype:attempted-user; sid:30940; rev:3;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows NtUserMessageCall implementation exploitation attempt"; flow:to_client,established; file_data; flowbits:isset,file.exe; file_data; content:"schlamperei.x86.dll|00|_ReflectiveLoader"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2013-1300; reference:url,technet.microsoft.com/en-us/security/bulletin/MS13-053; classtype:attempted-user; sid:30939; rev:3;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Microsoft Windows DosDevices mapping privilege escalation attempt"; flow:to_server,established; file_data; content:"|0F BE C9 88 5C 01 04 33 C0 40 8B 4D FC 5F 5E 33 CD 5B E8 EF 63 FF FF 8B E5 5D C3 80 39 30 75 05|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service smtp; reference:cve,2015-1644; reference:url,technet.microsoft.com/en-us/security/bulletin/ms15-038; classtype:attempted-user; sid:34081; rev:1;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"FILE-EXECUTABLE Microsoft Windows DosDevices mapping privilege escalation attempt"; flow:to_server,established; file_data; content:"|E8 40 03 00 00 59 59 85 C0 0F 84 A3 00 00 00 FF 76 14 8B 45 08 FF 70 18 57 E8 C2 B4 FF FF 83 C4|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service smtp; reference:cve,2015-1644; reference:url,technet.microsoft.com/en-us/security/bulletin/ms15-038; classtype:attempted-user; sid:34080; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows DosDevices mapping privilege escalation attempt"; flow:to_client,established; file_data; content:"|0F BE C9 88 5C 01 04 33 C0 40 8B 4D FC 5F 5E 33 CD 5B E8 EF 63 FF FF 8B E5 5D C3 80 39 30 75 05|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2015-1644; reference:url,technet.microsoft.com/en-us/security/bulletin/ms15-038; classtype:attempted-user; sid:34079; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"FILE-EXECUTABLE Microsoft Windows DosDevices mapping privilege escalation attempt"; flow:to_client,established; file_data; content:"|E8 40 03 00 00 59 59 85 C0 0F 84 A3 00 00 00 FF 76 14 8B 45 08 FF 70 18 57 E8 C2 B4 FF FF 83 C4|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2015-1644; reference:url,technet.microsoft.com/en-us/security/bulletin/ms15-038; classtype:attempted-user; sid:34078; rev:1;)
