# Copyright 2001-2015 Sourcefire, Inc. All Rights Reserved.
#
# This file contains (i) proprietary rules that were created, tested and certified by
# Sourcefire, Inc. (the "VRT Certified Rules") that are distributed under the VRT
# Certified Rules License Agreement (v 2.0), and (ii) rules that were created by
# Sourcefire and other third parties (the "GPL Rules") that are distributed under the
# GNU General Public License (GPL), v2.
# 
# The VRT Certified Rules are owned by Sourcefire, Inc. The GPL Rules were created
# by Sourcefire and other third parties. The GPL Rules created by Sourcefire are
# owned by Sourcefire, Inc., and the GPL Rules not created by Sourcefire are owned by
# their respective creators. Please see http://www.snort.org/snort/snort-team/ for a
# list of third party owners and their respective copyrights.
# 
# In order to determine what rules are VRT Certified Rules or GPL Rules, please refer
# to the VRT Certified Rules License Agreement (v2.0).
#
#---------------------
# BROWSER-OTHER RULES
#---------------------

# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER local loopback address in html"; flow:to_client,established; file_data; content:"http|3A 2F 2F|127."; fast_pattern:only; metadata:policy max-detect-ips drop, service http; reference:url,tools.ietf.org/html/rfc990; classtype:unknown; sid:26879; rev:6;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"BROWSER-OTHER Novell Messenger Client nim URI handler buffer overflow attempt"; flow:to_server,established; file_data; content:"nim:import?"; fast_pattern; nocase; content:"filename="; distance:0; nocase; isdataat:486,relative; content:!">"; within:486; pcre:"/nim:import\?[^\x22\x27>\s]*?filename=[^\x22\x27>\s]{485}/i"; metadata:policy balanced-ips drop, policy security-ips drop, service smtp; reference:cve,2013-1085; reference:url,osvdb.org/show/osvdb/91477; reference:url,www.novell.com/support/kb/doc.php?id=7011935; classtype:attempted-user; sid:26490; rev:3;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Novell Messenger Client nim URI handler buffer overflow attempt"; flow:to_client,established; file_data; content:"nim:import?"; fast_pattern; nocase; content:"filename="; distance:0; nocase; isdataat:486,relative; content:!">"; within:486; pcre:"/nim:import\?[^\x22\x27>\s]*?filename=[^\x22\x27>\s]{485}/i"; metadata:policy balanced-ips drop, policy security-ips drop, service ftp-data, service http, service imap, service pop3; reference:cve,2013-1085; reference:url,osvdb.org/show/osvdb/91477; reference:url,www.novell.com/support/kb/doc.php?id=7011935; classtype:attempted-user; sid:26489; rev:3;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera browser window null pointer dereference attempt"; flow:to_client,established; file_data; content:"window.open|28|"; content:"document.createElement|28|"; within:50; nocase; content:"document.body.appendChild|28|"; within:50; nocase; content:".close|28|"; within:50; nocase; content:"document.cloneNode|28|"; within:50; nocase; metadata:service http; reference:bugtraq,46872; classtype:attempted-user; sid:25653; rev:1;)
# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"BROWSER-OTHER Opera use after free attempt"; flow:to_server,established; file_data; content:"window.opera.collect|28 29|"; fast_pattern:only; content:"<svg"; content:"<clipPath"; content:"document.createElement"; content:"use"; within:3; distance:2; pcre:"/\x3cclippath\s*?id\s*?\x3d[\x22\x27](?P<id_name>\w+).*?(\x3ccircle|\x3crect|\x3cellipse|\x3cline|\x3cpolyline|\x3cpolygon)\s*?id\s*?\x3d\s*?[\x22\x27](?P<shape_name>\w+).*?document\x2egetElementById\x28[\x22\x27](?P=shape_name).*?\x3d\s*[\x22\x27]url\x28\x23(?P=id_name)/smi"; metadata:service smtp; reference:url,pastie.org/6029531#32; classtype:attempted-user; sid:25622; rev:2;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera use after free attempt"; flow:to_client,established; file_data; content:"window.opera.collect|28 29|"; fast_pattern:only; content:"<svg"; content:"<clipPath"; content:"document.createElement"; content:"use"; within:3; distance:2; pcre:"/\x3cclippath\s*?id\s*?\x3d[\x22\x27](?P<id_name>\w+).*?(\x3ccircle|\x3crect|\x3cellipse|\x3cline|\x3cpolyline|\x3cpolygon)\s*?id\s*?\x3d\s*?[\x22\x27](?P<shape_name>\w+).*?document\x2egetElementById\x28[\x22\x27](?P=shape_name).*?\x3d\s*[\x22\x27]url\x28\x23(?P=id_name)/smi"; metadata:service ftp-data, service http, service imap, service pop3; reference:url,pastie.org/6029531#32; classtype:attempted-user; sid:25621; rev:3;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER suspicious named empty form detected"; flow:to_client,established; file_data; content:"<form "; content:"</form>"; within:30; pcre:"/<form\s*id\s*=\s*\x22[^\x22]*\x22\s*>\s*<\x2fform>/smi"; metadata:service http; classtype:attempted-user; sid:25124; rev:2;)
# alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"BROWSER-OTHER Puffin Browser usage detected"; flow:to_server,established; content:"X-Puffin-UA|3A| "; fast_pattern:only; http_header; metadata:service http; reference:url,www.puffinbrowser.com; classtype:policy-violation; sid:24474; rev:1;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER HTML5 canvas element heap spray attempt"; flow:to_client,established; file_data; content:"Uint8ClampedArray(1024*1024)|3B|"; fast_pattern:only; metadata:service ftp-data, service http, service imap, service pop3; reference:url,corelabs.coresecurity.com/index.php?module=Wiki&action=view&type=publication&name=HTML5_Heap_Sprays_Pwn_All_The_Things; classtype:shellcode-detect; sid:24433; rev:4;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER HTML5 canvas element heap spray attempt"; flow:to_client,established; file_data; content:" for"; content:"document.createElement(|27|canvas|27|)"; within:100; nocase; content:"getContext(|27|2d|27|)"; within:200; nocase; content:"createImageData("; within:200; nocase; metadata:service ftp-data, service http, service imap, service pop3; reference:url,corelabs.coresecurity.com/index.php?module=Wiki&action=view&type=publication&name=HTML5_Heap_Sprays_Pwn_All_The_Things; classtype:shellcode-detect; sid:24432; rev:6;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera Web Browser History Search Input validation vulnerability"; flow:established,to_client; file_data; content:"<html"; content:"#<script"; distance:0; fast_pattern; content:"</html>"; distance:0; metadata:service http; reference:bugtraq,31869; reference:cve,2008-4696; classtype:attempted-user; sid:21399; rev:3;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Multiple web browser window injection attempt"; flow:to_client,established; file_data; content:"onunload"; fast_pattern; content:"open"; nocase; pcre:"/(\S*)onunload\s*\x3D\s*([^\x3B]*)\x3B\s*\x7D\s*function\2\s*\x28\s*\x29\s*\x7B[^\x7D]*\1open[^\x7D]*\x7D/smi"; metadata:service http; reference:cve,2004-1155; classtype:misc-attack; sid:20743; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera Config File script access attempt"; flow:to_client,established; file_data; content:"opera|3A|config"; fast_pattern; nocase; content:"opera|3A|cache"; nocase; metadata:service http; reference:url,osvdb.org/show/osvdb/66472; classtype:attempted-user; sid:20535; rev:6;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera file URI handling buffer overflow"; flow:to_client,established; file_data; content:"var file = |22|file|3A 2F 2F 22 3B 0A 0A|"; nocase; content:"var i = 0|3B| i<16438|3B|"; distance:0; nocase; metadata:policy max-detect-ips drop, service http; reference:bugtraq,32323; reference:cve,2008-5178; classtype:attempted-user; sid:18597; rev:9;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera file URI handling buffer overflow"; flow:to_client,established; file_data; content:"file|3A 2F 2F|"; fast_pattern:only; pcre:"/(src|href)\s*=\s*(\x22|\x27|)file\x3a\x2f\x2f[^\s\x22\x27]{900}/smi"; metadata:policy max-detect-ips drop, service http; reference:bugtraq,32323; reference:cve,2008-5178; classtype:attempted-user; sid:17725; rev:11;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera browser document writing uninitialized memory access attempt"; flow:to_client,established; file_data; content:"document.write"; content:"setInterval"; fast_pattern:only; pcre:"/function\s+(?P<func>[a-z\x5F]+).+?\x7B[^\x7D]+?document\x2Ewrite[^\x7D]+?setInterval\x28(?P=func)/is"; metadata:policy max-detect-ips drop, policy security-ips drop, service http; reference:bugtraq,39855; reference:cve,2010-1728; classtype:attempted-user; sid:17165; rev:9;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera asynchronous document modifications attempted memory corruption"; flow:to_client,established; file_data; content:"function loop|28 29|"; content:"setInterval|28|doit,0|29|"; distance:0; content:"function doit|28 29|"; distance:0; content:"document.write"; distance:0; content:"setInterval|28|loop,0|29|"; distance:0; metadata:service http; reference:url,secunia.com/advisories/39590/; reference:url,www.opera.com/support/kb/view/953/; classtype:attempted-user; sid:16592; rev:5;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Opera Content-Length header integer overflow attempt"; flow:to_client,established; content:"Content-Length"; nocase; http_header; pcre:"/^Content-Length\s*\x3A\s*[^\n]{20}/miH"; metadata:policy max-detect-ips drop, service http; reference:bugtraq,38519; reference:cve,2010-1349; reference:url,www.hack0wn.com/view.php?xroot=672.0&cat=exploits; classtype:attempted-user; sid:16481; rev:12;)
# alert tcp $EXTERNAL_NET [8088,$HTTP_PORTS] -> $HOME_NET any (msg:"BROWSER-OTHER Multiple web browsers HTTP chunked transfer-encoding memory corruption attempt"; flow:to_client,established; content:"Transfer-Encoding"; nocase; http_header; content:"chunked"; fast_pattern; nocase; http_header; pkt_data; pcre:"/^Transfer-Encoding\s*\x3a\s*chunked.*\n0*[8-9a-f][0-9a-f]{7}\s*\n/smi"; metadata:policy max-detect-ips drop, service http; reference:bugtraq,35462; reference:cve,2005-2922; reference:cve,2009-0086; reference:cve,2009-2121; reference:url,technet.microsoft.com/en-us/security/bulletin/MS09-013; classtype:attempted-user; sid:15462; rev:20;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Mozilla Netscape XMLHttpRequest local file read attempt"; flow:to_client,established; file_data; content:"new XMLHttpRequest|28|"; content:"file|3A|//"; nocase; metadata:ruleset community, service http; reference:bugtraq,4628; reference:cve,2002-0354; classtype:web-application-attack; sid:1735; rev:13;)
# alert tcp $HOME_NET any -> $EXTERNAL_NET 80 (msg:"BROWSER-OTHER Netscape 4.7 unsucessful overflow"; flow:to_server,established; content:"3|C9 B1 10|?|E9 06|Q<|FA|G3|C0|P|F7 D0|P"; metadata:ruleset community; reference:bugtraq,822; reference:cve,1999-1189; reference:cve,2000-1187; classtype:unsuccessful-user; sid:311; rev:15;)
# alert tcp $EXTERNAL_NET 80 -> $HOME_NET any (msg:"BROWSER-OTHER Netscape 4.7 client overflow"; flow:to_client,established; content:"3|C9 B1 10|?|E9 06|Q<|FA|G3|C0|P|F7 D0|P"; metadata:ruleset community; reference:bugtraq,822; reference:cve,1999-1189; reference:cve,2000-1187; classtype:attempted-user; sid:283; rev:14;)
# alert tcp $EXTERNAL_NET 443 -> $HOME_NET any (msg:"BROWSER-OTHER known revoked certificate for Tresor CA"; flow:to_client,established; ssl_state:server_hello; content:"|30 82 03 6C 30 82 02 54 A0 03 02 01 02 02 03 03 1D A7|"; fast_pattern:only; content:"130718100528Z|17 0D|140718100528Z"; content:"AC DG Tr|C3 A9|sor SSL"; metadata:policy security-ips drop; reference:url,technet.microsoft.com/en-us/security/advisory/2916652; classtype:bad-unknown; sid:28893; rev:2;)
# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"BROWSER-OTHER suspicious srcElement child element removal - possible use after free attempt"; flow:to_server,established; file_data; content:"srcElement.parentNode.removeChild"; pcre:"/srcElement\x2eparentNode\x2eremoveChild\s*\x28[^\x29]*srcElement/"; metadata:policy security-ips drop, service smtp; classtype:attempted-user; sid:30959; rev:2;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER suspicious srcElement child element removal - possible use after free attempt"; flow:to_client,established; file_data; content:"srcElement.parentNode.removeChild"; pcre:"/srcElement\x2eparentNode\x2eremoveChild\s*\x28[^\x29]*srcElement/"; metadata:policy security-ips drop, service ftp-data, service http, service imap, service pop3; classtype:attempted-user; sid:30958; rev:2;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER Android WebView same origin policy bypass attempt"; flow:to_client,established; file_data; content:"window.open"; content:"00javascript|3A|"; within:30; content:"document"; within:50; reference:bugtraq,69548; reference:cve,2014-6041; reference:url,osvdb.org/show/osvdb/110664; classtype:misc-activity; sid:32029; rev:1;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"BROWSER-OTHER WGet symlink arbitrary file write attempt"; flow:to_client,established; content:"total "; depth:6; content:"|0D 0A|l"; within:20; content:" -> "; within:100; metadata:policy security-ips drop, service ftp; reference:bugtraq,70751; reference:cve,2014-4877; classtype:attempted-user; sid:32375; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"BROWSER-OTHER FreeBSD tnftp client detected"; flow:to_server,established; content:"User-Agent|3A| tnftp/"; fast_pattern:only; http_header; flowbits:set,tnftp; flowbits:noalert; metadata:service http; classtype:protocol-command-decode; sid:32525; rev:1;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER FreeBSD tnftp fetch_url client side command injection attempt"; flow:to_client,established; flowbits:isset,tnftp; content:"Location|3A|"; http_header; content:"/|7C|"; distance:0; fast_pattern; http_header; pcre:"/^Location\x3a\s[^\s\r\n]+?\x2f\x7c/Hmi"; metadata:service http; reference:bugtraq,70792; reference:cve,2014-8517; reference:url,osvdb.org/show/osvdb/114233; classtype:attempted-user; sid:32524; rev:1;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"BROWSER-OTHER FreeBSD tnftp fetch_url client side command injection attempt"; flow:to_client,established; flowbits:isset,tnftp; content:"Location|3A|"; http_header; content:"/%7C"; distance:0; fast_pattern; nocase; http_header; pcre:"/^Location\x3a\s[^\s\r\n]+?\x2f%7C/Hmi"; metadata:service http; reference:bugtraq,70792; reference:cve,2014-8517; reference:url,osvdb.org/show/osvdb/114233; classtype:attempted-user; sid:32523; rev:1;)
# alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"BROWSER-OTHER Microsoft Internet Explorer cross site scripting filter bypass attempt"; flow:to_server,established; content:"%U00"; fast_pattern:only; content:"%U00"; http_raw_uri; pcre:"/(script|onload|src|alert)/Ii"; metadata:service http; reference:cve,2014-6328; reference:url,technet.microsoft.com/en-us/security/bulletin/MS14-080; classtype:attempted-user; sid:32713; rev:1;)
# alert tcp $EXTERNAL_NET 443 -> $HOME_NET any (msg:"BROWSER-OTHER Network Security Services NSS library RSA signature forgery attempt"; flow:to_client,established; ssl_state:server_keyx; content:"|2A 86 48 86 F7 0D 01 01 05|"; fast_pattern; content:"|03|"; within:1; distance:2; content:"|00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|"; within:20; distance:3; metadata:service ssl; reference:bugtraq,70116; reference:cve,2014-1568; reference:url,googlechromereleases.blogspot.ca/2014/09/stable-channel-update_24.html; reference:url,www.mozilla.org/en-US/security/advisories/mfsa2014-73/; classtype:misc-activity; sid:33664; rev:1;)
